<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>rplace Server - Backups</title>
    <link rel="stylesheet" href="styles.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
        .highlight {
            border-radius: 4px;
            background-color: yellow;
            box-shadow: -2px -2px 4px darkkhaki inset;
        }
        
        #previewCanvas {
            position: fixed;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            width: 40%;
            aspect-ratio: 1/1;
            background: white;
            opacity: 0.3;
            border: 1px solid #afb2b4;
            border-radius: 4px;
        }
    </style>
    <script>
        function search(val) {
            let str = val.toLowerCase().trim()
            let links = document.getElementsByTagName("a")
            for (let link of links) {
                let text = link.innerText.toLowerCase()
                if (text === "..") return
                if (str.length && text.indexOf(str) || !str) link.classList.remove("highlight")
                else link.classList.add("highlight")
            }
        }
        
        async function backupHovered(event) {
            previewCanvas.style.visibility = 'visible'
            let response = await fetch(event.target.href)
            if (!response.ok) {
                backupLeft(null)
                return
            }
            
            let placeView = new DataView(await response.arrayBuffer())
            let metadataLength = placeView.getInt16(placeView.byteLength - 2)
            let boardLength = placeView.byteLength - metadataLength
            let boardWidth = placeView.getUint32(boardLength)
            previewCanvas.setAttribute("width", boardWidth)
            previewCanvas.setAttribute("height", boardWidth / boardLength)

            var palette = new List<uint>();
            for (var i = boardLength + 4; i < packedBoard.Length - 2; i++)
            {
                palette.Add(BinaryPrimitives.ReadUInt32BigEndian(packedBoard[i..(i + 4)]));
            }
            
            let palette = []
            for (let i = boardLength + 4; i < boardLength - 2; i += 4) {
                palette.push()
            }
            
            console.log(metadataLength)
        }
        
        function backupLeft(_) { previewCanvas.style.visibility = 'hidden' }
        
        async function getList() {
            let backupList = (await (await fetch("./backuplist")).text()).split("\n")
            for (let backup of backupList) {
                let anchor = document.createElement("a")
                anchor.innerText = backup
                anchor.href = "./backups/" + backup
                anchor.onmouseover = backupHovered
                anchor.onmouseleave = backupLeft
                backupsContainer.appendChild(anchor)
                backupsContainer.appendChild(document.createElement("br"))
            }
        }
        getList()
    </script>
</head>
<body>
    <header>
        <img src="https://raw.githubusercontent.com/rslashplace2/rslashplace2.github.io/main/images/rplace.png" alt="rplace_logo">
        <h1>rplace canvas place file/backup list.</h1>
    </header>
    <div class="reddit-cards-container">
        <div>
            <div></div>
            <div>
                <h2 style="margin: 0;">Here you can find a list of links to all available canvas backups!</h2>
                <span>See [domain-url]/backuplist.txt for cleanly formatted list of backups saved here.</span>
                <span style="color: red;font-style: italic;">(Do not try to iterate through the backups listed on this page with code, please instead use the plaintext list at /backuplist.)</span>
                <input type="text" placeholder="Search.." onkeyup="search(this.value)">
            </div>
        </div>
        <div>
            <div></div>
            <div id="backupsContainer"></div>
        </div>
    </div>
    <canvas id="previewCanvas" style="visibility: hidden;"></canvas>
</body>
</html>
